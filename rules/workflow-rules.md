# Workflow Rules

## Session Management

### State Persistence
- All user responses during intake MUST be saved to `input/intake-responses.md`
- Generated outputs MUST include ISO date in filename
- Session activity SHOULD be logged to `output/session-log.md`

### File Naming Convention
```
[type]-[name]-[YYYY-MM-DD].md

Examples:
- risk-assessment-2024-01-15.md
- sop-evacuation-2024-01-15.md
- flowchart-power-outage-2024-01-15.md
- checklist-go-bag-2024-01-15.md
- action-plan-2024-01-15.md
```

### Version Control
- Major revision = new file with new date
- Minor updates = edit in place, update "Last Updated" field
- Keep previous versions for reference (don't delete old assessments)

## Output Standards

### All Documents Must Include

**Header Block**:
```markdown
**Version**: X.Y
**Created**: YYYY-MM-DD
**Last Updated**: YYYY-MM-DD
**Review By**: YYYY-MM-DD
```

**Footer Block**:
```markdown
---
*Document generated by Claude Preparedness Planner*
*Review schedule: [frequency]*
*Print recommended: [Yes/No]*
```

### Formatting Requirements

1. **Use Markdown** for all outputs
2. **Tables** for structured data
3. **Checkboxes** `[ ]` for actionable items
4. **Bold** for critical information
5. **Headers** with clear hierarchy
6. **Line length** reasonable for printing

### Print Optimization

Documents marked "Print recommended: Yes" should:
- Avoid reliance on hyperlinks
- Use high-contrast formatting
- Keep critical info on single pages where possible
- Include page numbers conceptually (## Page 1, etc.)

## Content Rules

### Personalization Priority

1. Always check for intake data before generating
2. If intake exists, personalize all recommendations
3. If no intake, offer generic version with note to complete intake
4. Never generate conflicting advice across documents

### Risk Language

- Use clear severity indicators (Critical, High, Moderate, Low)
- Avoid unnecessarily alarming language
- Focus on empowerment, not fear
- Acknowledge uncertainty where appropriate

### Recommendation Quality

All recommendations must be:
- **Specific**: "Store 14 gallons of water" not "store some water"
- **Actionable**: Include how, not just what
- **Sourced**: Include where to buy/learn when relevant
- **Prioritized**: Clear about what matters most

### No Armchair Expertise

- For medical advice: Always include "consult healthcare provider"
- For legal matters: Always include "consult legal professional"
- For financial advice: Include appropriate disclaimers
- For security/weapons: Defer to local laws and professional training

## User Interaction Rules

### Interview Conduct

1. Ask one section at a time
2. Allow skipping with notation
3. Don't repeat questions unnecessarily
4. Summarize periodically
5. Confirm before finalizing

### Clarification Protocol

When user input is ambiguous:
1. State your interpretation
2. Ask for confirmation
3. Proceed only when clear

### Sensitive Topics

Handle with care:
- Medical conditions
- Financial situations
- Security concerns
- Family dynamics
- Past trauma

Approach:
- Ask only what's needed
- Don't probe unnecessarily
- Accept "prefer not to answer"
- Note limitations this creates

## Output Generation Rules

### SOP Generation

1. Always include "Immediate Actions" section
2. Maximum 3 decision points before action
3. Include resource/equipment list
4. Add troubleshooting section
5. Specify print locations

### Flowchart Generation

1. Start node clearly marked
2. All paths reach terminal node
3. Maximum 3 branches per decision
4. Include criteria definitions
5. Must render in Mermaid

### Checklist Generation

1. Group by category/location
2. Include quantities
3. Add specifications where relevant
4. Note rotation dates for consumables
5. Include sourcing suggestions

### Assessment Generation

1. Cite specific intake data points
2. Explain risk ratings
3. Compare to baselines
4. Prioritize clearly
5. End with actionable next steps

## Cross-Document Consistency

### When Updating Any Document

1. Check for related documents
2. Update cross-references
3. Ensure no conflicting advice
4. Maintain consistent terminology

### Terminology Glossary

Maintain consistent terms:
- "Rally point" (not "meeting place", "rendezvous")
- "Go-bag" (not "bug-out bag", "emergency kit")
- "Shelter-in-place" (not "hunker down", "stay inside")
- "Out-of-area contact" (not "emergency contact", "backup contact")

## Review Cycle Defaults

| Document Type | Review Frequency |
|--------------|------------------|
| Risk Assessment | Annual |
| Action Plan | Quarterly |
| SOPs | Annual |
| Checklists | Bi-annual |
| Quick References | Annual |

## Quality Gates

Before finalizing any document:

- [ ] Filename follows convention
- [ ] Header block complete
- [ ] All sections populated
- [ ] Personalized if intake exists
- [ ] No placeholder text remaining
- [ ] Actionable items have checkboxes
- [ ] Cross-references are valid
- [ ] Footer block complete
